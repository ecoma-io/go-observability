{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"go-observability","text":"<p>Lightweight observability helpers for Go microservices: configuration patterns, structured logging (Zap), and OpenTelemetry integration (traces &amp; metrics).</p>"},{"location":"#quick-links","title":"Quick links","text":"<ul> <li>Overview and architecture</li> <li>Getting started</li> <li>Configuration and runtime flags</li> <li>Logging and tracing</li> <li>Middleware (Gin, gRPC)</li> </ul>"},{"location":"#architecture","title":"Architecture","text":"<pre><code>flowchart LR\n  A[Config Loading] --&gt; B[Logger Init]\n  B --&gt; C[OTEL Init]\n  C --&gt; D[Service Implementation]\n  D --&gt; E[Traces -&gt; OTLP]\n  D --&gt; F[Metrics -&gt; Prometheus/OTLP]\n  D --&gt; G[Logs -&gt; stdout JSON]\n</code></pre>"},{"location":"audit/","title":"Source Code Audit &amp; Recommendations","text":"<p>This page summarizes a focused code review of the <code>go-observability</code> core sources and presents actionable recommendations to improve robustness, security, and operability.</p>"},{"location":"audit/#what-i-reviewed","title":"What I reviewed","text":"<ul> <li><code>config.go</code>, <code>logger.go</code>, <code>otel.go</code>, <code>gin_middleware.go</code>, <code>grpc_interceptor.go</code>, <code>metadata.go</code> and   README examples.</li> </ul>"},{"location":"audit/#findings-recommendations","title":"Findings &amp; Recommendations","text":"<ol> <li>Metrics &amp; Tracing exporters default to <code>WithInsecure()</code></li> <li>Finding: OTLP exporters are initialized with <code>WithInsecure()</code>.</li> <li> <p>Recommendation: Add configuration flags to opt into TLS, custom certs, or securely provisioned      endpoints in production.</p> </li> <li> <p>Internal metrics server uses <code>fmt.Printf</code> for errors</p> </li> <li>Finding: The Prometheus metrics server logs errors with <code>fmt.Printf</code>.</li> <li> <p>Recommendation: Use the library <code>Logger</code> (or accept a logger) to keep logs consistent and      structured.</p> </li> <li> <p>Validation could be more explicit / tested</p> </li> <li>Finding: <code>finalizeAndValidate()</code> uses reflection and returns generic errors for      misconfiguration.</li> <li> <p>Recommendation: Add explicit unit tests for validation paths and consider returning      typed/config-specific errors for better programmatic handling.</p> </li> <li> <p>Graceful shutdown ergonomics</p> </li> <li>Finding: <code>InitOtel</code> returns a shutdown function but callers should provide a context with      timeout.</li> <li> <p>Recommendation: Document best-practice shutdown sequence (context with timeout) and consider      adding a helper that accepts a timeout parameter.</p> </li> <li> <p>Documentation &amp; examples</p> </li> <li>Finding: README contains extensive examples; docs site should mirror them and provide runnable      commands.</li> <li> <p>Recommendation: Generate API reference (mkdocstrings or godoc -&gt; markdown) and include runnable      snippets for <code>pull</code>, <code>push</code>, and <code>hybrid</code> modes.</p> </li> <li> <p>ObservabilityMiddlewareConfig behavior</p> </li> <li>Finding: <code>SkipRoute</code> predicate takes precedence over <code>ExcludedPaths</code>, which is reasonable but      should be highlighted in docs.</li> <li>Recommendation: Document examples and edge-cases (e.g., prefix matching, regex-based skipping)      or provide helpers for common patterns.</li> </ol>"},{"location":"audit/#suggested-immediate-changes-low-effort-high-impact","title":"Suggested immediate changes (low effort, high impact)","text":"<ul> <li>Replace internal <code>fmt.Printf</code> calls with <code>logger</code> usage.</li> <li>Add <code>METRICS_TLS_ENABLED</code> / <code>OTEL_TLS</code> env flags (or reuse <code>OTEL_*</code> conventions) for exporter   security.</li> <li>Add a small test suite for <code>finalizeAndValidate()</code> covering invalid <code>METRICS_MODE</code>, missing   <code>SERVICE_NAME</code>, and invalid <code>LOG_LEVEL</code>.</li> <li>Add <code>mkdocstrings</code> to <code>mkdocs.yml</code> to auto-generate API docs from Go sources (or add a script to   generate markdown via <code>godoc</code>).</li> </ul>"},{"location":"audit/#next-steps-for-docs-enrichment","title":"Next steps for docs enrichment","text":"<ul> <li>Auto-generate API reference for public types and functions.</li> <li>Add step-by-step migration examples for <code>pull</code>, <code>push</code>, and <code>hybrid</code> metrics modes with   docker-compose snippets.</li> <li>Add a section for production hardening and security considerations (TLS, auth, endpoints).</li> </ul> <p>If you want, I can open PR patches to implement the low-effort fixes above (logger usage and adding TLS flags), and add unit tests for validation.</p>"},{"location":"configuration/","title":"Configuration","text":"<p>This project exposes a <code>BaseConfig</code> pattern for embedding into service configs. Key points:</p> <ul> <li>Priority order: LDFlags &gt; .env file &gt; Environment variables.</li> <li>Load via <code>observability.LoadCfg(&amp;cfg)</code> which validates and injects build metadata.</li> <li>Modes for metrics: <code>IsPull()</code>, <code>IsPush()</code>, <code>IsHybrid()</code>.</li> </ul>"},{"location":"configuration/#example-pseudo","title":"Example (pseudo)","text":"<pre><code>type Config struct {\n  observability.BaseConfig\n  DatabaseURL string `env:\"DATABASE_URL\"`\n}\n\nvar cfg Config\nobservability.LoadCfg(&amp;cfg)\n</code></pre>"},{"location":"configuration/#baseconfig-fields","title":"<code>BaseConfig</code> fields","text":"<p>The library exposes a <code>BaseConfig</code> struct with defaults and validation. Important fields:</p> Field Env var Default Notes <code>ServiceName</code> <code>SERVICE_NAME</code> (required) Injected via LDFlags or env; required by <code>LoadCfg</code> validation <code>Version</code> - <code>dev</code> Usually injected at build-time with <code>-ldflags</code> <code>BuildTime</code> - <code>unknown</code> Injected at build-time <code>LogLevel</code> <code>LOG_LEVEL</code> <code>info</code> Allowed: <code>debug</code>, <code>info</code>, <code>warn</code>, <code>error</code> <code>OtelEndpoint</code> <code>OTEL_ENDPOINT</code> <code>localhost:4318</code> OTLP/HTTP endpoint for traces <code>MetricsPort</code> <code>METRICS_PORT</code> <code>9090</code> HTTP port for Prometheus pull server <code>OtelTracingSampleRate</code> <code>OTEL_TRACING_SAMPLE_RATE</code> <code>1.0</code> Trace sampling ratio (0.0 - 1.0) <code>MetricsMode</code> <code>METRICS_MODE</code> <code>pull</code> <code>pull</code>, <code>push</code>, or <code>hybrid</code> <code>MetricsPath</code> <code>METRICS_PATH</code> <code>/metrics</code> Path served by Prometheus handler <code>MetricsPushEndpoint</code> <code>METRICS_PUSH_ENDPOINT</code> - Required when <code>METRICS_MODE</code> is <code>push</code>/<code>hybrid</code> <code>MetricsPushInterval</code> <code>METRICS_PUSH_INTERVAL</code> <code>30</code> Seconds between push exports <code>MetricsProtocol</code> <code>METRICS_PROTOCOL</code> <code>http</code> <code>http</code> or <code>grpc</code> for OTLP metrics push"},{"location":"configuration/#validation-rules-performed-by-loadcfg","title":"Validation rules performed by <code>LoadCfg()</code>","text":"<ul> <li>Ensures <code>SERVICE_NAME</code> is set (or injected via LDFlags) and non-empty.</li> <li>Validates <code>LOG_LEVEL</code> is one of <code>debug|info|warn|error</code>.</li> <li>Validates <code>METRICS_MODE</code> is <code>pull|push|hybrid</code> and requires <code>METRICS_PUSH_ENDPOINT</code> for   <code>push</code>/<code>hybrid</code>.</li> <li>Validates <code>METRICS_PROTOCOL</code> is <code>http</code> or <code>grpc</code>.</li> </ul> <p><code>LoadCfg</code> behavior summary:</p> <ul> <li>Reads <code>.env</code> file if present, otherwise reads environment variables.</li> <li>Injects build metadata via the <code>MetadataSetter</code> interface when implemented by the service config.</li> <li>Calls <code>finalizeAndValidate()</code> to enforce configuration invariants.</li> </ul> <p>Examples and troubleshooting are provided in <code>getting-started.md</code> and <code>e2e.md</code>.</p>"},{"location":"contributing/","title":"Contributing","text":"<p>See repository-level <code>CONTRIBUTING.md</code> for contribution guidelines.</p> <p>Docs-specific notes:</p> <ul> <li>Use the <code>docs/</code> folder for content.</li> <li>Preview locally with <code>mkdocs serve</code>.</li> <li>Open a PR to <code>main</code> (or target docs branch) when ready.</li> </ul>"},{"location":"examples/","title":"Examples","text":"<p>This repo includes several example services in the <code>examples/</code> folder:</p> <ul> <li><code>examples/gin-example</code></li> <li><code>examples/gin-service</code></li> <li><code>examples/grpc-service</code></li> <li><code>examples/simple-service</code></li> </ul> <p>Each example contains a <code>README.md</code> with run instructions. For local quick-run:</p> <pre><code>cd examples/gin-service\ngo run main.go\n</code></pre>"},{"location":"examples/#detailed-examples","title":"Detailed examples","text":""},{"location":"examples/#gin-example-examplesgin-example","title":"Gin Example (<code>examples/gin-example</code>)","text":"<p>Purpose: demonstrates middleware with route skipping, panic recovery, tracing and Prometheus metrics.</p> <p>Run:</p> <pre><code>export SERVICE_NAME=gin-example\nexport LOG_LEVEL=info\nexport OTEL_ENDPOINT=localhost:4318\nexport METRICS_PORT=9090\nexport PORT=8080\ncd examples/gin-example\ngo run main.go\n</code></pre> <p>Key endpoints:</p> <ul> <li><code>GET /ping</code> \u2014 tracked</li> <li><code>GET /users/:id</code> \u2014 tracked</li> <li><code>GET /health</code>, <code>/metrics</code>, <code>/status</code> \u2014 skipped by default</li> <li><code>GET /error</code> \u2014 triggers panic/recovery</li> </ul> <p>Integration: start <code>e2e</code> stack to view Jaeger/Prometheus UIs.</p>"},{"location":"examples/#gin-service-examplesgin-service","title":"Gin Service (<code>examples/gin-service</code>)","text":"<p>Purpose: simple Gin service showcasing endpoints and observability middleware.</p> <p>Run:</p> <pre><code>export SERVICE_NAME=gin-service\nexport PORT=8080\nexport METRICS_PORT=9090\nexport OTEL_ENDPOINT=localhost:4318\ngo run examples/gin-service/main.go\n</code></pre> <p>Test:</p> <pre><code>curl http://localhost:8080/ping\ncurl http://localhost:8080/users/123\ncurl http://localhost:8080/panic\ncurl http://localhost:8080/error\n</code></pre>"},{"location":"examples/#grpc-service-examplesgrpc-service","title":"gRPC Service (<code>examples/grpc-service</code>)","text":"<p>Purpose: demonstrates unary and streaming interceptors, panic recovery, and grpcurl testing.</p> <p>Run:</p> <pre><code>export SERVICE_NAME=grpc-service\nexport OTEL_ENDPOINT=localhost:4318\nexport METRICS_PORT=9090\ncd examples/grpc-service\ngo run main.go\n</code></pre> <p>Test with <code>grpcurl</code>:</p> <pre><code>grpcurl -plaintext -d '{\"name\":\"World\"}' localhost:50051 hello.HelloService/SayHello\ngrpcurl -plaintext -d '{\"name\":\"Stream\"}' localhost:50051 hello.HelloService/SayHelloStream\n</code></pre>"},{"location":"examples/#simple-service-examplessimple-service","title":"Simple Service (<code>examples/simple-service</code>)","text":"<p>Purpose: minimal service showing tracing and metrics with a <code>/ping</code> endpoint.</p> <p>Run:</p> <pre><code>export SERVICE_NAME=simple-service\nexport PORT=8080\nexport METRICS_PORT=9090\nexport OTEL_ENDPOINT=localhost:4318\ngo run examples/simple-service/main.go\n</code></pre> <p>Test:</p> <pre><code>curl http://localhost:8080/ping\n</code></pre> <p>Each example includes its README for more details. Use the <code>e2e</code> stack in <code>e2e/</code> to view Jaeger and Prometheus dashboards when running examples with OTEL configured.</p>"},{"location":"getting-started/","title":"Getting Started","text":"<p>Quickstart (local):</p> <p>Install dependencies and run docs preview:</p> <pre><code>python -m pip install -r requirements.txt\nmkdocs serve -a 0.0.0.0:8000\n</code></pre> <p>Run an example service (from repository root):</p> <pre><code>cd examples/gin-service\ngo run main.go\n# Metrics available at http://localhost:9090/metrics (if OTEL in pull mode)\n</code></pre>"},{"location":"gin-middleware.md/","title":"Middleware &amp; Interceptors","text":"<ul> <li>Gin middleware: <code>observability.GinTracing(...)</code> \u2014 auto-creates spans, logs requests, recovers   panics.</li> <li>gRPC interceptor: <code>observability.GrpcUnaryServerInterceptor(logger)</code> \u2014 captures status and trace   context.</li> </ul> <p>Example (Gin):</p> <pre><code>r := gin.Default()\nr.Use(observability.GinTracing(\"my-service\"))\n</code></pre>"},{"location":"gin-middleware.md/#gin-middleware-details","title":"Gin middleware details","text":"<p>The package exposes the following middleware helpers:</p> <ul> <li><code>GinTracing(serviceName string)</code> / <code>GinTracingWithConfig(serviceName, cfg)</code> \u2014 starts server spans   for incoming HTTP requests and extracts W3C trace context from headers. Injects <code>X-Trace-ID</code> in   responses when available.</li> <li><code>GinLogger(logger *Logger)</code> / <code>GinLoggerWithConfig(logger, cfg)</code> \u2014 logs requests with latency,   status, client IP, user-agent and trace context.</li> <li><code>GinRecovery(logger *Logger)</code> / <code>GinRecoveryWithConfig(logger, cfg)</code> \u2014 recovers panics, logs stack   trace and returns structured <code>ErrorResponse</code> JSON with optional <code>trace_id</code>.</li> <li><code>GinMiddleware(logger, serviceName)</code> \u2014 convenience to return the full chain: tracing, recovery,   logger.</li> </ul> <p><code>ObservabilityMiddlewareConfig</code> supports:</p> <ul> <li><code>ExcludedPaths []string</code> \u2014 exact-match paths to skip (e.g., <code>/health</code>, <code>/metrics</code>).</li> <li><code>SkipRoute func(path string) bool</code> \u2014 user-supplied predicate to decide skipping (takes precedence   over <code>ExcludedPaths</code>).</li> </ul> <p>Usage notes:</p> <ul> <li>Skipped routes do not create spans, do not log, and do not record metrics.</li> <li><code>GinRecovery</code> logs the full stack trace and returns a consistent JSON error structure for clients.</li> </ul>"},{"location":"gin-middleware.md/#grpc-interceptors","title":"gRPC interceptors","text":"<ul> <li><code>GrpcUnaryServerInterceptor(logger)</code> \u2014 logs unary RPCs with gRPC status, latency and trace   context.</li> <li><code>GrpcStreamServerInterceptor(logger)</code> \u2014 logs streaming RPCs with similar fields.</li> <li><code>GrpcUnaryRecoveryInterceptor</code> and <code>GrpcStreamRecoveryInterceptor</code> \u2014 recover from panics in   handlers and return <code>codes.Internal</code>.</li> <li><code>GrpcUnaryInterceptors(logger)</code> and <code>GrpcStreamInterceptors(logger)</code> \u2014 helper to return   interceptor chains (recovery + logging).</li> </ul> <p>Usage example:</p> <pre><code>server := grpc.NewServer(\n  grpc.ChainUnaryInterceptor(observability.GrpcUnaryInterceptors(logger)...),\n  grpc.ChainStreamInterceptor(observability.GrpcStreamInterceptors(logger)...),\n)\n</code></pre>"},{"location":"gin-middleware.md/#notes-from-code-review","title":"Notes from code review","text":"<ul> <li>gRPC recovery interceptors inject <code>trace_id</code> into trailers when available to aid debugging.</li> <li><code>setTrailer</code> wraps <code>grpc.SetTrailer</code> and deliberately ignores the returned values to satisfy   linters; this is acceptable but documented for reviewers.</li> </ul>"},{"location":"grpc/","title":"gRPC Interceptors","text":"<p>This project provides gRPC interceptors for unary and streaming RPCs that add logging, tracing, and panic recovery.</p> <p>Key helpers:</p> <ul> <li><code>GrpcUnaryServerInterceptor(logger *observability.Logger)</code> \u2014 logs unary RPC calls with latency,   gRPC status, and trace context.</li> <li><code>GrpcStreamServerInterceptor(logger *observability.Logger)</code> \u2014 logs streaming RPCs and their   metadata.</li> <li><code>GrpcUnaryRecoveryInterceptor(logger *observability.Logger)</code> \u2014 recovers from panics and converts   them to <code>codes.Internal</code> errors, attaching <code>trace_id</code> metadata when available.</li> <li><code>GrpcStreamRecoveryInterceptor(logger *observability.Logger)</code> \u2014 similar to unary recovery but for   streams.</li> <li><code>GrpcUnaryInterceptors(logger)</code> / <code>GrpcStreamInterceptors(logger)</code> \u2014 return interceptor chains   (recovery + logging) for easy wiring.</li> </ul> <p>Usage example:</p> <pre><code>server := grpc.NewServer(\n    grpc.ChainUnaryInterceptor(observability.GrpcUnaryInterceptors(logger)...),\n    grpc.ChainStreamInterceptor(observability.GrpcStreamInterceptors(logger)...),\n)\n</code></pre> <p>Notes:</p> <ul> <li>Recovery interceptors log panics with stack traces and attempt to set <code>trace_id</code> in response   trailers for easier debugging.</li> <li>Interceptors rely on OpenTelemetry context propagation; ensure <code>InitOtel</code> has been called in your   service initialization.</li> </ul>"},{"location":"logging/","title":"Logging","text":"<p>The library provides a Zap-based logger with service metadata auto-attached.</p> <p>Create a logger:</p> <pre><code>logger := observability.NewLogger(&amp;cfg.BaseConfig)\ndefer logger.Sync()\nlogger.Info(\"starting service\", \"version\", observability.GetVersion())\n</code></pre> <p>Logs are JSON to stdout and include service metadata for easy ingestion.</p>"},{"location":"logging/#implementation-details","title":"Implementation details","text":"<p><code>NewLogger</code> constructs a Zap <code>SugaredLogger</code> with JSON encoder and the following characteristics:</p> <ul> <li>Time encoding: <code>ISO8601</code> (field key <code>timestamp</code>).</li> <li>Output: <code>os.Stdout</code> (JSON lines suitable for log collectors).</li> <li>Caller information and stacktraces included for error level logs.</li> <li>Pre-attaches <code>service</code> and <code>version</code> fields from <code>BaseConfig</code>.</li> </ul> <p>The <code>Logger</code> wrapper exposes convenience methods: <code>Info</code>, <code>Error</code>, <code>Debug</code>, <code>Warn</code>, <code>Fatal</code>, <code>Sync</code>.</p>"},{"location":"logging/#best-practices","title":"Best practices","text":"<ul> <li>Always call <code>defer logger.Sync()</code> to flush any buffered logs before process exit.</li> <li>Use structured key/value pairs, e.g., <code>logger.Info(\"cache miss\", \"key\", key)</code>.</li> <li>Prefer the wrapper methods on <code>observability.Logger</code> to keep log format consistent across   services.</li> </ul>"},{"location":"logging/#notes-from-code-review","title":"Notes from code review","text":"<ul> <li><code>Sync()</code> error is intentionally ignored in the implementation to avoid noisy shutdown errors;   consider logging the error when debugging shutdown issues.</li> </ul>"},{"location":"otel/","title":"OpenTelemetry","text":"<p>Initialize OTEL with:</p> <pre><code>shutdown, err := observability.InitOtel(cfg.BaseConfig)\nif err != nil { /* handle */ }\ndefer shutdown(context.Background())\n</code></pre> <p>Modes:</p> <ul> <li><code>pull</code>: Prometheus exporter on <code>:9090/metrics</code></li> <li><code>push</code>: OTLP push to configured endpoint</li> <li><code>hybrid</code>: both active</li> </ul> <p>Tracer usage:</p> <pre><code>tracer := observability.GetTracer(\"component-name\")\nctx, span := tracer.Start(ctx, \"operation-name\")\ndefer span.End()\n</code></pre>"},{"location":"otel/#metrics-and-tracing-modes-implementation-details","title":"Metrics and Tracing modes (implementation details)","text":"<p><code>InitOtel</code> configures tracing (OTLP/HTTP push by default) and metrics using one of three modes:</p> <ul> <li><code>pull</code> (Prometheus): creates a Prometheus exporter and starts an internal HTTP server on   <code>0.0.0.0:&lt;MetricsPort&gt;</code> serving <code>MetricsPath</code>.</li> <li><code>push</code> (OTLP): creates an OTLP metrics exporter and registers a periodic reader to push metrics to   <code>MetricsPushEndpoint</code>. Protocol can be <code>http</code> or <code>grpc</code> based on <code>MetricsProtocol</code>.</li> <li><code>hybrid</code>: combines both pull and push behaviors.</li> </ul> <p>If no readers are configured, the implementation falls back to a Prometheus exporter (pull).</p>"},{"location":"otel/#shutdown-behavior","title":"Shutdown behavior","text":"<p><code>InitOtel</code> returns a shutdown function that:</p> <ul> <li>Force flushes the MeterProvider and TracerProvider.</li> <li>Shuts down the internal metrics HTTP server (if pull mode is enabled).</li> <li>Calls <code>Shutdown()</code> on the TracerProvider and MeterProvider and any push-specific shutdown   functions.</li> </ul> <p>Call the returned <code>shutdown(ctx)</code> during service termination (use a context with timeout for graceful shutdown).</p>"},{"location":"otel/#notes-from-code-review","title":"Notes from code review","text":"<ul> <li>The trace exporter and metric exporter constructors are configured with <code>WithInsecure()</code>; consider   adding a config option to enable TLS or provide certificates for production deployments.</li> <li>Internal metrics server logs errors via <code>fmt.Printf</code> \u2014 in services prefer using   <code>observability.Logger</code> to keep logs consistent.</li> <li>Ensure <code>METRICS_PUSH_ENDPOINT</code> is reachable from the runtime environment when using   <code>push</code>/<code>hybrid</code> modes.</li> </ul>"}]}